%---------------------------------------------
% This document is for pdflatex
%---------------------------------------------
\documentclass[11pt]{article}

\usepackage{amsmath,amsfonts,amssymb,graphicx,setspace,authblk}
\usepackage{float}
\usepackage[running]{lineno}
\usepackage[vmargin=1in,hmargin=1in]{geometry}
\usepackage[sc]{mathpazo} %Like Palatino with extensive math support

\usepackage[authoryear]{natbib}

\graphicspath{ {./../genetic-diversity/figures/} {./../community-turnover/figures/} }

\usepackage{enumitem}
\setlist{topsep=.125em,itemsep=-0.15em,leftmargin=0.75cm}

\usepackage{gensymb}

\usepackage[compact]{titlesec} 

\usepackage{bm,mathrsfs}

\usepackage{ifpdf}
\ifpdf
\DeclareGraphicsExtensions{.pdf,.png,.jpg}
\usepackage{epstopdf}
\else
\DeclareGraphicsExtensions{.eps}
\fi

\renewcommand{\floatpagefraction}{0.98}
\renewcommand{\topfraction}{0.99}
\renewcommand{\textfraction}{0.05}

\clubpenalty = 10000
\widowpenalty = 10000

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%% Just for commenting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[usenames]{color}
\newcommand{\new}{\textcolor{red}}
\newcommand{\spe}{\textcolor{blue}}
\newcommand{\comment}{\textcolor{black}}

\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\ba}{\begin{equation} \begin{aligned}}
\newcommand{\ea}{\end{aligned} \end{equation}}

\def\X{\mathbf{X}}

\floatstyle{boxed}
\newfloat{Box}{tbph}{box}

\title{\textbf{ Matching the forecast horizon with the relevant ecological processes }}

\author[1]{Peter B. Adler}  %\thanks{Corresponding author. Department of Wildland Resources and the Ecology Center, Utah State University, Logan, Utah Email: peter.adler@usu.edu}}
\author[2]{Ethan White}
\author[1]{Michael Cortez?}
\author[3]{Heather Lynch?}
\affil[1]{Department of Wildland Resources and the Ecology Center, Utah State University, Logan, Utah}
\affil[2]{some shitty Florida joint}

\renewcommand\Authands{ and }

% \date{Last compile: \today} 

\sloppy

\renewcommand{\baselinestretch}{1.25}

\begin{document}

\maketitle

\linenumbers

\section*{Abstract}

stuff

\textbf{\large{Keywords:}} dispersal, ecological forecasting, eco-evolutionary dynamics, global change, selection

\section*{Introduction}

* Forecasting is important
* Two different approaches to this time-series & space-for-time
	* Not clear which is best
	* Some limited comparisons
* Which approach is best may depend on the time-horizon
* Here we explore this possibility using simulation based approach

Forecasting is increasingly recognized as important to the advancement and application of ecological research.
Ecological forecasting is necessary to guide the environmental policy and management
decisions that are increasingly critical under global change \citep{clark_ecological_2001,mouquet_review:_2015,dietze_iterative_2018}.
In addition, evaluating the accuracy of ecological forecasts can provide rigorous tests of predictions from ecological models that can
advance understanding of the processes governing ecological systems  
\citep{houlahan_priority_2017,dietze_prediction_2017,dietze_iterative_2018}.
This combined value of advancing our fundamental understanding of ecology and applying that understanding to support management and decision making 
makes that forecasting is an important priority for ecological research.

Ecological models used for forecasting have traditionally been based on either time-series modeling or space-for-time substitutions.
Time-series approaches use the historical behavior of a system to fit models that describe the temporal dynamics of that system and use those
dynamic models to make predictions about what will happen in the future. This is a common approach for population based forecasts and includes both
process based population models and data-driven models capturing empirical patterns in data (e.g., \citep{ward_complexity_2014}). Time-series models
capture processes like birth, death, small scale dispersal events, and short-term responses to environmental conditions.
Alternatively, space-for-time modeling approaches develop models of how and ecological property varies in across space in response to environmental
conditions. These spatial relationships are assumed to also hold for changes at a site through time, and forecasts are made by forecasting future
environmental conditions and determining the associated ecological response. Most forecasts for future species distributions and biodiversity
are based on this type of approach, with a models built to describe the environmental conditions where species occur across space being applied to
forecast environmental conditions to determine where they will occur in the future (e.g., citation). Space-for-time models capture processes like
immigration, extinction, and responses to large changes in environmental conditions over long time periods. Despite both of these approaches being
widely used there has been little comparison of how they compare for forecasting and understanding the dynamics of ecological systems \citep{harris_forecasting_2018}.

Whether historical dynamics, contemporary spatial patterns, or a combination of the two will serve as the best source of information for forecasting
may depend on how far into the future we are attempting to forecast \citep{harris_forecasting_2018}. This potential dependency on the "forecast horizon"; ()\textit{sensu} citation)
results from lags in the response of ecological conditions to environmental change, changes in the importance of ecological processes with
time scale \citep{levin_1992,rosenzweig_1995}, and differences between time-series and spatial gradients in the range of conditions present in the data.
At short forecast horizons (days to years) processes driving individual demographics tend to dominate (similar to the time scales present in that
historical data), conditions are likely to stay within the range of the historical data at a site, and the current state of the system is likely
to capture the influence of unmeasured processes. As a result, for near-term forecasts time-series approaches may effectively capture the key dynamics
and result in accurate forecasts. In contrast, at long forecast horizons (decades) an ecosystem is likely to experience conditions that have not been
historically observed () and be responding to large scale processes large scale climate and land use change that are difficult to detect in even long
ecological time-series. Therefore, for the kinds of long-term forecasts typically conducted in biodiversity and species-distribution modeling
space-for-time based approaches may include important information about how ecosystems respond to major shifts in climate over long periods and as a
results produce better long-term forecasts. Using different approaches for different time horizons is common in other areas of forecasting,
including forecasts for environmental conditions where models for short-term changes (weather) differ substantially from those for long-term changes
(climate).

Here we investigate the possibility that the best approaches for building models for ecological forecasting may depend on the time horizon of the forecast
and explore how time-series and space-for-time approaches might be combined to address mid-term ecological forecasting. We do this using two simulation case studies, one 
focused on how competitive interactions affect population dynamics of a focal species and one eco-evolutionary scenario. Our analyses show that: 
\begin{enumerate}
	\item For short-term forecasts, phenomenological time-series approaches are hard to beat, whereas longer-term forecasts require understanding slow 
	processes such as evolutionary and ecological selection as well as dispersal.
	\item Different kinds of data reflect the operation of different processes: longitudinal data capture autocorrelation and responses of current assemblages, while 
	data spanning spatial gradients capture the long-term outcome of selection and dispersal.  Whether predictive models should be trained using longitudinal or
	spatial data sets, or both, depends on the time-scale of the desired forecast.
	\item A key challenge for future research is determining the rate at which slow processes first influence and ultimately dominate dynamics.
\end{enumerate}

\section*{Modeling approach}

In both of our case studies, we simulate the effects of a hypothetical temperature increase on a simple system with known dynamics.
The ``truth'' is represented by a model that is mechanistic for at least one important process, but we assume that recovering 
this true, process-based model would be impossible in practice (we return to this point in the Discussion). We begin each simulation
under stationary temperature, allowing the system to equilibrate; we call this the baseline phase. We then increase temperature progressively
over a period of time, followed by a second period of stationary, now elevated, temperature. The objective is to forecast the response of the 
system to temperature increase based on data gathered during the baseline period. 

We make two forecasts based on two different phenomenological models, each representing processes operating at different time scales. 
The first phenomenological model represents what we call a ``spatial approach.'' We correlate the mean environment with the mean of an ecological state or rate 
 across many sites. This is the approach commonly used to predict population distribution or abundance as a function of climate \citep{elith_species_2009} or
 primary production as a function of mean precipitation \citep{Sala1988}. The approach is attractive because it addresses broad spatial scales relevant to 
 management, and because the necessary data are widely available and statistical analyses are straightforward. The approach also has well-known weaknesses.
Criticism often focuses on the assumption that current spatial patterns are in equilibrium with climate (refs?). Another issue is that these models are not dynamic; 
they provide no information about how quickly the system will move from the current state to the predicted, future state. Because the patterns in the data have developed 
over long time spans, they are unlikely to provide much information about dynamic changes on the order of years to decades. Moreover, transient dynamics could 
prevent the system from ever reaching the predicted steady state \citep{Urban2012}. 

The second model represents what we call a ``temporal approach.'' We correlate interannual variation in an ecological response with interannual variation in the environment, 
typically at just one site. This approach is often used to study population or vital rate fluctuations as a function of weather \citep{dalgleish_climate_2011}, 
or primary production as a function of precipitation \citep{lauenroth_long-term_1992}. The advantages of this approach include is focus on temporal dynamics, meaning it 
can predict rates of change, and validation of the resulting near-term predictions are straightforward. However, models built using this approach typically cover 
a limited spatial extent (but see \citealt{kleinhesselink_response_2018}, others), and ignore slower processes, such as evolutionary adaptation or turnover in community composition, 
that could alter the underlying process at longer time scales.

We compare forecasts from both models to the true, simulated dynamics to show that responses to environmental change reflect both kinds of processes, but at different time scales. To quantify this pattern, we combine forecasts from the spatial and temporal approaches with a weighted average and then show how the optimal model weights change over time: we expect the temporal model to best predict short-term dynamics, and the spatial model to best predict long-term dynamics. How rapidly that transition occurs depends on the rate of  ``slow" processes such as species turnover and evolution. 

\subsection*{Community turnover example}

A common problem for conservation biologists and natural resource managers is anticipating the impact of environmental change on the abundance of 
endangered species, biological invaders, and harvested species. Although the managers may be primarily interested in just the focal species, 
skillful prediction might require considering interactions with many other species, greatly complicating the problem. But at what forecast horizon do
altered species interactions become impossible to ignore? We explored this question using a metacommunity model developed by \cite{alexander_lags_2018}. 
The model describes Lotka-Volterra competitive interactions among plants within sites that are arrayed along an elevation and temperature gradient.
Composition varies along the gradient because of a trade-off between growth rate and cold tolerance: 
cold sites are dominated by slow-growing species that can tolerate low temperatures, while warm sites are dominated by 
fast-growing species that are cold intolerant. Multiple species can coexist within sites because all species experience stronger competition from conspecifics than from heterospecifics. 
Sites are linked by dispersal: a specified fraction of each species' offspring leaves the site where they were produced and reaches all other sites with equal probability. All computer code is available on Github: \texttt{https://github.com/pbadler/space-time-forecast}).

We first simulated a baseline period with variable but stationary temperature, followed by a period of rapid temperature increase, and then a 
final period of stationary temperature. Interannual variation in temperature is the same at all sites, but mean temperature varies among sites. All sites experienced the 
same absolute increase in mean temperature. We focused on the biomass dynamics of one focal species that dominated the baseline period.

Dynamics during the baseline period revealed very strong spatial patterns across the mean temperature gradient. 
Individual species, including our focal species, showed classic, unimodal ``Whittaker" patterns of abundances across the gradient (Fig. \ref{fig:species-patterns-models}A).
These spatial patterns are the basis for our ``spatial model" of the temperature-biomass relationship for our focal species (Fig. \ref{fig:species-patterns-models}A). 
In contrast to the strong spatial patterns, population and community responses to interannual variation in temperature within sites were weak.
At our focal site in the center of the gradient, the biomass of the focal species was quite insensitive to interannnual variation in temperature (Fig. \ref{fig:species-patterns-models}B). Our ``temporal model" estimates this weak, linear temperature effect, along with strong lag effects of biomass in the previous year. The spatial and temporal statistical
models are described in Appendix \ref{models}.

\begin{figure}[tbp]
\centering
\includegraphics[width=1 \textwidth] {species_patterns_models.png}
\caption{(A) Mean biomass by species (colors) across the temperature gradient during the baseline period. The focal species, dominant at the site in the center of the gradient (vertical gray line), is shown in dark blue. The dashed blue line shows predictions from the spatial model. (B) Annual biomass of the focal species at the central site during the baseline period. The dashed line shows predictions from the temporal model. }
\label{fig:species-patterns-models}
\end{figure}

We forecasted the effect of temperature increase on the focal species' biomass at one location in the center of the temperature gradient 
using the spatial models and the temporal models. 
The predictions from the spatial and temporal model contrasted markedly, with the temporal 
model predicting a large increase in biomass and the spatial model predicting a decrease. Initially, the simulated abundances followed the increase predicted by the 
temporal model, but as faster-growing species colonized and increased in abundance at the study site, the biomass of the focal species then decreased, eventually falling below its baseline level (Fig. \ref{fig:community-forecast-species}). 

To combine the spatial and temporal model into a single forecast, we fit a weighting parameter, $\omega$, which varies over time and is bounded between 0 and 1. At any time point, $t$, the combined population forecast is $\omega * T(N_{t-1},K_t) + (1-\omega) * S(K_t) $ where $T$ is the temporal model, which depends on population size, $N$ and expected temperature, $K$, and $S$ is the spatial model, which depends only on $K$ (see Appendix \ref{models} for full description of the approach).
This combined model accurately predicts the simulated dynamics across the full forecast horizon (Fig. \ref{fig:community-forecast-species}) 
because the weights were determined by fitting directly to those data. Unlike our spatial and temporal model forecasts, 
we did not generate out-of-sample predictions from the combined model; it merely provides 
a convenient way to quantify how rapidly dynamics shift from from being dominated by the interannual 
variations captured in the temporal model to being dominated by the steady-state equilibrium captured by the spatial model.
The most rapid shifts in model weights occur during the period when warm-adapted, faster growing species are increasing most rapidly
in abundance (Fig. \ref{fig:community-weights-spp}). A true, combined forecast would require a method to determine the model weights \emph{a priori}.

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {community_forecast_species.png}
\caption{(Top) Simulated annual temperatures (grey) and expected temperature (black), which was used to make forecasts, at the focal site. (Bottom) Simulated focal species biomass and forecasts from the spatial, temporal and combined models. }
\label{fig:community-forecast-species}
\end{figure}

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {community_change_plus_weights_spp.png}
\caption{Simulated changes in biomass of the focal species (black) and all other species (grey) at the focal site in the metacommunity model, and the weight given to the temporal model for focal species biomass (blue). Year 0 in this figure corresponds to the start of the temperature increase. }
\label{fig:community-weights-spp}
\end{figure}

The compositional turnover affecting our focal species also influences total biomass, linking community and ecosystem dynamics. We repeated our focal species analysis 
for total community biomass, and the results were similar: the temporal model initially made the best forecasts immediately following the onset of the temperature
increase, but as the identify and abundances of species at the study site changed, the model weights rapidly shifted to the spatial model (Figs. \ref{fig:community-models-total} to \ref{fig:community-weights-total}). 

\section*{Eco-evolutionary example}

Evolutionary adaptation is a key uncertainty in predicting how environmental change will impact a focal population at a given location (refs). Like the shifts
in species composition illustrated in the previous example, shifts in genotype frequencies can also influence dynamics and forecasts at different time scales.
We demonstrate this process with a hypothetical annual plant population in which fecundity is temperature dependent, and different genotypes have different temperature optima (Fig. \ref{fig:evo_evo_spatial_temporal_models}A). The full model description is provided in Appendix \ref{eco-evo}, and all computer code is available on Github  (\texttt{https://github.com/pbadler/space-time-forecast}). Genotype frequencies will shift across a gradient of mean annual temperature: cold sites will be dominated by the cold-adapted homozygous genotype, warm sites will be dominated by the heat-adapted homozygous genotype, and intermediate sites will be dominated by the heterozygous genotype (Fig. \ref{fig:evo_evo_spatial_temporal_models}B).

\begin{figure}[tbp]
\centering
\includegraphics[width=0.4 \textwidth]{spatial&temporal_model.png}
\caption{(A) Reaction norms of the three genotypes. (B) The spatial pattern of individual genotypes (colors) and total population abundance (black) at sites arrayed across a gradient of mean annual temperature. The dashed line shows predictions from an empirical ``spatial model," a linear regression that describes mean population size as a function of mean temperature. (C) The relationship between annual temperature and per capita growth rate at a location with a mean temperature that favors the cold-adapted genotype. Colors show population size (the blue to red gradient depicting low to high population density), which influences the population growth rate through density dependence. }
\label{fig:evo_evo_spatial_temporal_models}
\end{figure}

The spatial pattern shown in Fig. \ref{fig:evo_evo_spatial_temporal_models}B is the outcome of steady-state conditions. But at any one site, the population's short-term response to temperature will be determined by the dominant genotype's reaction norm. For example, at a cold site dominated by the cold-adapted homozygous genotype, a warmer than average year would cause a decrease in population size, even though the heat-adapted homozygote might perform optimally at that same temperature. However, if warmer than normal conditions persist for many years, then genotype frequencies should shift, and the heat-adapted homozygote will compensate for the decreases of the cold-adapted genotype. 

To demonstrate these dynamics, we simulated a diploid annual plant population at a colder than average site. During the baseline period, the population is dominated by the cold-adapted genotype. We used the simulated data from this baseline period to fit an empirical model that assumes no knowledge of the underlying eco-evolutionary process. This empirical ``temporal model" (Appendix \ref{models}) predicts population growth rate as a function of annual temperature and population size (Fig. \ref{fig:evo_evo_spatial_temporal_models}C). 

We then imposed a period of warming, followed by a final period of higher, but stationary, temperature (Fig. \ref{fig:forecast} top). With the onset of warming, the population crashed as the cold-adapted genotype decreased in abundance. Eventually, frequencies of the heterozygous genotype and the warm-adapted homozygous genotype began to increase and the population recovered (Fig. \ref{fig:forecast} bottom). The implications for forecasting are clear: In the initial stages of the warming trend, the temporal model fit to the original, baseline conditions should make better the best predictions about resulting population trends, but in the longer term, as evolutionary change occurs, the spatial model ultimately makes better predictions. 

As in the eco-evolutionary example, we also fit a combined model as a weighted average of the spatial and temporal model, with the weights changing over time. 
The temporal model accurately predicted the impact of the initial warming trend, but eventually became far too pessimistic, while the spatial model did not handle the initial trend but accurately predicted the eventual, new steady state (Fig. \ref{fig:forecast} bottom). The combined model initially reflected the temporal model, but then rapidly transitioned to reflect the spatial model. The rapid transition in the weighting term, $\omega$, occured during the period of most rapid change in genotype frequencies (Fig. \ref{fig:forecast_supp}). The combined model's predictions look impressively accurate, but, as in the community turnover example, that is because we used the full, simulated time series to fit the weighting term. 
To generate a true forecast from the combined model, we would need an independent method to predict how the model weights shift over time.

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {forecast.png}
\caption{(Top) Simulated annual temperatures (grey) and expected temperature (black), which was used to make forecasts. (Bottom) Simulated population size and forecasts from the spatial, temporal and combined models.  }
\label{fig:forecast}
\end{figure}

\subsection*{Discussion}

Our simulations demonstrate three lessons:

\emph{Lesson 1: For short-term forecasts, phenomenological time-series approaches are hard to beat, whereas longer-term forecasts require understanding slow 
processes such as evolutionary and ecological selection as well as dispersal.} [Ethan, I am hoping you can fix and add to this paragraph, perhaps
drawing from examples in other fields?] In the short-term, time-series approaches work well because lag effects are strong: the state of the system in the next 
time step depends heavily on the current state. Furthermore, in the short-term we usually are not extrapolating far into novel conditions; the historical range of variation 
may be a good guide when there has been little time for genotype frequencies or species composition to change. In contrast, farther we forecast into the future, 
the weaker the influence of the current state, and the more likely that slow processes like selection and dispersal will alter genotype frequencies and
species composition.
		
This lesson has implications for the emerging field of ecological forecasting. If we only focus on iterative, near-term forecasting, we are likely to find 
that time-series approaches work well, and that consideration of slow processes like evolution, dispersal, and compositional turnover rarely improves
forecast skill. Assuming that the same models will make good longer-term forecasts would be a mistake.

We do not mean to undermine the call for an emphasis on near-term forecasting. Building capacity to make near-term forecasts is extremely important, not
only because of the many critical applications (examples?) but because it is a necessary step to building a disciplinary culture and practice of ecological 
forecasting (cite Dietze?). It is also feasible, because we have the data to validate forecasts at short time-scales. Rather, the point is that near-term forecasting
alone is not enough. We also need to build capacity to make forecasts at time-scales where slow ecological processes cannot be ignored. The challenge 
will be finding ways to validate long-term predictions. 

\emph{Lesson 2. Different kinds of data reflect the operation of different processes; the choice of data for model training should depend on the time-scale of the desired forecast}.
Longitudinal data capture autocorrelation and responses of current assemblages, while data spanning spatial gradients capture the long-term outcome of 
selection and dispersal. For short-term forecasts, building models using longitudinal data is clearly the best choice. As our simulations show, models fit to 
steady-state, spatial patterns make terrible predictions in the short term. Conversely, models based on longitudinal data make poor predictions in the long-term,
while the models fit to spatial patterns can perform well. Although the temporal and spatial models we fit are phenomenological, they capture different kinds
 of underlying processes. The traditional debate about phenomenological vs. process-based models obscures the fact that, depending on the choice of the
 training data, phenomenological models can represent different kinds of processes.
 
 Why not simply build a process-based model? Perhaps something like the process-based models we used to generate the simulated time series in the first place? 
 That kind of model could make good predictions at both short and long time-scales. Unfortunately, this approach is just not feasible in most cases.
 The first challenge is simply determining the critical process. Take our eco-evolutionary example: should we simply assume that every annual plant species
 has warm and cold-adapted genotypes? And that temperature adaptation will be the key trait driving the response to warming, as opposed to the effects of 
 compositional turnover highlighted in our second example? Second, even if the key process is known in advance, fitting a mechanistic model presents its
 own set of challenges. The model for our eco-evolutionary example requires, in order of increasing empirical difficulty, demographic rates for the full life
 cycle, including density dependence, a quantitative mapping of genotype-by-environment interactions onto fitness, and dispersal kernels. The model for 
 our community and ecosystem example requires demography, environment-dependent intra- and interspecific competition coefficients, and dispersal kernels.
 We can think of empirical models that capture some of these features, but not all of them. Finally, even were it possible to fit such a model, the high number of 
 parameters and associated parameter error might lead to poor predictive skill (refs?).
 
Inevitably, models used for ecological forecasting will be partially if not entirely phenomenological. But that does not mean that they will not rely on process-based
understanding in some way. The point of our simulations is that different processes should be considered for different forecast time-scales, and this can be done 
by fitting phenomenological models to different kinds of data sets. Even when process-level understanding does not enable a fully mechanistic model, it can
improve the specification of phenomenological models.
 
\emph{Lesson 3. A key challenge for future research is determining the rate at which slow processes first influence and ultimately dominate dynamics.}
Our simulated examples suggest the potential for a combined forecast, which weights predictions from spatial and temporal models, to 
accurately forecast both short and long-term dynamics. But we cheated: our combined ``forecasts'' were fit to data, not generated prospectively
using \emph{a priori} model weights. Finding a general solution for determining those weights poses a fascinating research problem whose 
solution would lead to important applications in ecological forecasting. 

We see a role for new theory and new empirical tests. On the theoretical side, what are the parameters that determine how quickly slow processes
influence dynamics? We can play with our simulation models to provide some qualitative answers. The effects of some parameters are intuitive: in the community turnover example, increasing the fraction of dispersing individuals causes a more rapid shift in species composition and in model weights (Fig. \ref{fig:dispersal_niche_width}A). But other parameters have less straightforward effects. In the eco-evolutionary model, a potentially important parameter is the temperature tolerance of each genotype. We initially thought that increasing the temperature tolerance might accelerate shifts in genotype frequencies by increasing genotypic diversity within populations, but it had the opposite effect (Fig. \ref{fig:dispersal_niche_width}B), probably because it decreased the strength of selection, slowing the rate of change in genotype frequencies. Other factors to consider include organism lifespans and the magnitude of directional environmental change relative to interannaul variation. While simulation experiments are easy and informative, they cannot provide the generality of analytical theory. Unfortunately, deriving analytical solutions would be difficult, even for our relatively simple models. 

\begin{figure}[tbp]
	\centering
	\includegraphics[width=0.7 \textwidth] {dispersal_niche_width.png}
	\caption{(The rate of change in the weight of the temporal forecast (y-axis) depends on (A) the fraction of propagules dispersing in the community turnover example and (B) on the temperature tolerance of genotypes, given by $\sigma_T$ (larger values indicate wider thermal niches) in the eco-evolutionary example. Year 0 in these figures corresponds to the start of the temperature increase. }
	\label{fig:dispersal_niche_width}
\end{figure}

On the empirical side, the key problem is finding or creating data sets to estimate the weighting function. As described under Lesson 1,
this requires data sets appropriate for validating long-term forecasts.
Possibilities include hindcasting with paleoecological and long-term historical data sets, use of model
systems with short-generation times, and....more simulation studies...? . With enough case studies, we might be able to infer patterns
that could guide applications in new systems.

Anything else to add?

\newpage
\renewcommand{\refname}{Literature cited}
\bibliographystyle{Ecology}
\bibliography{references}


%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
% APPENDICES !
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\clearpage 
\newpage 

\setcounter{page}{1}
\setcounter{equation}{0}
\setcounter{figure}{0}
\setcounter{section}{0}
\setcounter{table}{0}

\centerline{\Large \textbf{Appendices}}

\renewcommand{\thesection}{\Alph{section}}

\section{Spatial, temporal and combined models}\label{models}

The spatial model, which we refer to as $S$, is a linear regression fit to ``observed" data on mean population size, $\bar{N}$ at a series of locations, $x$, which vary in mean temperature, $K$. In our case, the observed data are simulated by the model described in the previous section. For both examples in the main text, we include a quadratic term to capture the unimodal relationship between  $\bar{N}$ and $K$:
 \begin{equation}
 \bar{N}_x = S(K_x) = \beta^S_0 +  \beta^S_1 K_x +\beta^S_2 {K_x}^2 + \varepsilon
 \label{eqn:spatial_regression}
 \end{equation}
For the total biomass example from the community turnover model (results in Appendix \ref{biomass}), we dropped the quadratic term.

The temporal model, which we call $T$, starts with a time series of ``observed" population sizes, or total biomasses, $\vec{N}$ at one location. In the community turnover example, we use data from a baseline period with a stationary distribution of annual temperature at the focal location, we fit the following regression, which predicts biomass at time $t+1$ as a function of biomass and annual temperature at time $t$:
 \begin{equation}
 \ln(N_{t+1}) = T(N_t,K_t) = \beta^T_0 +  \beta^T_1 ln(N_t) +\beta^T_2 K_t  +  \varepsilon
 \label{eqn:temporal_regression_community}
 \end{equation}
 For the eco-evolutionary example, the response variable is the log of the population growth rate, and we include a quadratic effect of annual temperature:
  \begin{equation}
  \ln(\frac{N_{t+1}}{N_t}) = T(N_t,K_t) = \beta^T_0 +  \beta^T_1 ln(N_t) +\beta^T_2 K_t  +\beta^T_3 K_t^2 +  \varepsilon
  \label{eqn:temporal_regression_ecoevo}
  \end{equation}
 This version of the temporal model returns a per capita growth rate on the log scale. To predict population size at the next time step, we simply exponentiate the growth rate and multiply it by the current population size: $exp(T(N_t,K_t)) N_t$.

The combined model is a weighted average of predictions from the spatial and temporal models, with the weights changing as a function of time, here expressed as the forecast horizon. The weights change as a function of the square root of the forecast horizon, to allow rapid shifts in the model weights. 
\begin{equation}
logit(\omega_t)=\beta^C_0 + \beta^C_1 \sqrt{t}
\label{eqn:weights}
\end{equation}
For the community turnover example, the predicted biomass from the combined model is:
\begin{equation}
\hat{N}_{t+1} = \omega *T(N_{t},K_t) + (1-\omega) * S(K_t) 
\label{eqn:combined_model}
\end{equation}
For the eco-evolutionary example, the predicted population size from the combined model is:
\begin{equation}
\hat{N}_{t+1} = \omega * exp(T(N_{t},K_t)) N_t + (1-\omega) * S(K_t) 
\label{eqn:combined_model}
\end{equation}

We used the \texttt{optim} function to estimate the $\beta^C$s that minimize the sum of squared errors, $(\hat{N}_{t+1} - N_{t+1})^2$

\section{Description of the eco-evolutionary annual plant model}\label{eco-evo}

\renewcommand{\theequation}{B-\arabic{equation}}
\renewcommand{\thetable}{B-\arabic{table}}
\renewcommand{\thefigure}{B-\arabic{figure}}

\noindent \textbf{Haploid Model:} Begin with a haploid model that describes the number of seeds present in a seed bank.  $N_{i,t}$ is the number of seeds of species $i$ at time $t$.  The model is
\begin{align}\begin{split}
N_{1,t+1} &= s_1 [1-g_1(E_t)]N_{1,t}+\frac{\lambda_1g_1(E_t)N_{1,t}}{1+ \alpha_{11}g_1(E_t)N_{1,t} + \alpha_{12}g_2(E_t)N_{2,t}}\\
N_{2,t+1} &= s_2 [1-g_2(E_t)]N_{2,t}+\frac{\lambda_2g_2(E_t)N_{2,t}}{1+ \alpha_{21}g_1(E_t)N_{1,t} + \alpha_{22}g_2(E_t)N_{2,t}}
\end{split}\end{align}
where $g_{i}(E_t)$ is the probability of germination, $E_t$ is the environmental quality at time $t$, $s_i$ is the seed survival probability for species $i$, and $\lambda_i$ is the seed production rate per plant.  Below I refer to the $\alpha_{ij}$ as intra- and inter-specific competition coefficients.  \\

\noindent \textbf{Diploid Model:} Consider a one-species diploid model.  The genotypes are denoted by $AA$, $Aa$, and $aa$.   The number of each genotypes at time $t$ is $N_{AA,t}$, $N_{Aa,t}$, and $N_{aa,t}$.  The germination rates for each genotype are $g_{AA}(E_t)$, $g_{Aa}(E_t)$, and $g_{aa}(E_t)$.  The seed survival probability and seed production rate for genotype $AA$ are $s_{AA}$ and $\lambda_{AA}$, respectively.  The analogous parameters for the other genotypes are similarly denoted.  The competition coefficients are denoted by $\alpha_{i,j}$, e.g., $\alpha_{AA,AA}$ or $\alpha_{AA,Aa}$.  Throughout we assume that gametes mix randomly in the population.  

First consider the case where the competition coefficients are zero ($\alpha_{i,j}=0$).  Let $T$ denote the total number of gamete-pairs produced in a given year,
\begin{equation}
T = \lambda_{AA}N_{AA,t}g_{AA}(E_t)+ \lambda_{Aa}N_{Aa,t}g_{Aa}(E_t)+\lambda_{aa}N_{aa,t}g_{aa}(E_t).
\end{equation}
The first term is the number of gamete-pairs produced by $AA$ individuals.  The second and third terms are the numbers of gamete-pairs produced by $Aa$ and $aa$ individuals, respectively. The proportion of $A$ gametes ($\phi_A$) and the proportion of $a$ gametes ($\phi_a$) are given by
\begin{align}\begin{split}
\phi_{A} &= \frac{\lambda_{AA}N_{AA,t}g_{AA}(E_t)+ \frac{1}{2}\lambda_{Aa}N_{Aa,t}g_{Aa}(E_t)}{T} \hspace{10pt} \text{and} \hspace{10pt} \phi_a = 1-\phi_{A}.
\end{split}\end{align}
Note that the $T$ in the denominator of $\phi_A$ shows up because we are computing proportions.  Combining all of these we get the dynamics for each genotype,
\begin{align}\begin{split}
N_{AA,t+1} &= s_{AA}[1-g_{AA}(E_t)]N_{AA,t} + \phi_A^2T\\
N_{Aa,t+1} &= s_{Aa}[1-g_{Aa}(E_t)]N_{Aa,t} + \phi_A\phi_aT\\
N_{aa,t+1} &= s_{aa}[1-g_{aa}(E_t)]N_{aa,t} + \phi_a^2T
\end{split}\end{align}

Now consider the case where the competition coefficients are non-zero ($\alpha_{i,j}\neq0$).  Including competition changes the way in which we compute $T$, $\phi_A$, and $\phi_a$.  Specifically, because the total number of seeds produced per year by each genotypes is reduced based on intra- and inter-specific competition, the total number of gamete-pairs becomes
\begin{align}\begin{split}
T &=  \frac{\lambda_{AA}N_{AA,t}g_{AA}(E_t)}{1+ \alpha_{AA,AA}g_{AA}(E_t)N_{AA,t} + \alpha_{AA,Aa}g_{Aa}(E_t)N_{Aa,t}+ \alpha_{AA,aa}g_{aa}(E_t)N_{aa,t}} \\ 
&+ \frac{\lambda_{Aa}N_{Aa,t}g_{Aa}(E_t)}{1+ \alpha_{Aa,AA}g_{AA}(E_t)N_{AA,t} + \alpha_{Aa,Aa}g_{Aa}(E_t)N_{Aa,t}+ \alpha_{Aa,aa}g_{aa}(E_t)N_{aa,t}}\\
&+\frac{\lambda_{aa}N_{aa,t}g_{aa}(E_t)}{1+ \alpha_{aa,AA}g_{AA}(E_t)N_{AA,t} + \alpha_{aa,Aa}g_{Aa}(E_t)N_{Aa,t}+ \alpha_{aa,aa}g_{aa}(E_t)N_{aa,t}}.
\label{eqn:defineT}
\end{split}\end{align}
The first line is the number of gamete-pairs produced by $AA$ individuals after accounting for the effects of competition.  The second and third lines are the numbers of gamete-pairs produced by $Aa$ and $aa$ individuals, respectively. The proportions of $A$ gametes and $a$ gametes are 
\begin{align}\begin{split}
\phi_A &= \frac{1}{T}\frac{\lambda_{AA}N_{AA,t}g_{AA}(E_t)}{1+ \alpha_{AA,AA}g_{AA}(E_t)N_{AA,t} + \alpha_{AA,Aa}g_{Aa}(E_t)N_{Aa,t}+ \alpha_{AA,aa}g_{aa}(E_t)N_{aa,t}} \\
&+ \frac{1}{2T}\frac{\lambda_{Aa}N_{Aa,t}g_{Aa}(E_t)}{1+ \alpha_{Aa,AA}g_{AA}(E_t)N_{AA,t} + \alpha_{Aa,Aa}g_{Aa}(E_t)N_{Aa,t}+ \alpha_{Aa,aa}g_{aa}(E_t)N_{aa,t}}\\
\phi_a &= 1- \phi_A
\label{eqn:definePhi}
\end{split}\end{align}
Combining all of this results in the same model as above,
\begin{align}\begin{split}
N_{AA,t+1} &= s_{AA}[1-g_{AA}(E_t)]N_{AA,t} + \phi_A^2T\\
N_{Aa,t+1} &= s_{Aa}[1-g_{Aa}(E_t)]N_{Aa,t} + 2 \phi_A\phi_aT\\
N_{aa,t+1} &= s_{aa}[1-g_{aa}(E_t)]N_{aa,t} + \phi_a^2T,
\end{split}\end{align}
but the definitions of $T$, $\phi_A$, and $\phi_a$ are given by equations (\ref{eqn:defineT}) and (\ref{eqn:definePhi}) . 

\section{Supplementary Figures}

\renewcommand{\thefigure}{C-\arabic{figure}}

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {community_models_total.png}
\caption{(Results for total biomass from the community turnover model. Blue points show mean total biomass during the baseline period at locations across the temperature gradient, and the blue line shows predictions from the spatial model. Red points show annual total biomass during the baseline period as a function of annual temperature at the central site on the gradient. The red line shows predictions from the temporal model.   }
\label{fig:community-models-total}
\end{figure}

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {community_forecast_total.png}
\caption{Results for total biomass from the community turnover model. (Top) Simulated annual temperatures (grey) and expected temperature (black), which was used to make forecasts, at the focal site. (Bottom) Simulated total biomass and forecasts from the spatial, temporal and combined models.  }
\label{fig:community-forecasts-total}
\end{figure}

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {community_change_plus_weights_total.png}
\caption{Simulated changes in biomass of all species (grey) at the focal site in the metacommunity model, and the weight given to the temporal model for total biomass (blue). Year 0 in this figure corresponds to the start of the temperature increase. }
\label{fig:community-weights-total}
\end{figure}

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {forecast_supplement.png}
\caption{Simulated shifts in genotype abundances, and the model weighting term, $\omega$, during the warming phase and the following stationary temperature phase. Year 0 in this figure corresponds to the start of the temperature increase.}
\label{fig:forecast_supp}
\end{figure}


\end{document}

