%---------------------------------------------
% This document is for pdflatex
%---------------------------------------------
\documentclass[11pt]{article}

\usepackage{amsmath,amsfonts,amssymb,graphicx,setspace,authblk}
\usepackage{float}
\usepackage[running]{lineno}
\usepackage[vmargin=1in,hmargin=1in]{geometry}
\usepackage[sc]{mathpazo} %Like Palatino with extensive math support

\usepackage[authoryear]{natbib}

\graphicspath{ {./../genetic-diversity/figures/} {./../community-turnover/figures/} }

\usepackage{enumitem}
\setlist{topsep=.125em,itemsep=-0.15em,leftmargin=0.75cm}

\usepackage{gensymb}

\usepackage[compact]{titlesec} 

\usepackage{bm,mathrsfs}

\usepackage{ifpdf}
\ifpdf
\DeclareGraphicsExtensions{.pdf,.png,.jpg}
\usepackage{epstopdf}
\else
\DeclareGraphicsExtensions{.eps}
\fi

\renewcommand{\floatpagefraction}{0.98}
\renewcommand{\topfraction}{0.99}
\renewcommand{\textfraction}{0.05}

\clubpenalty = 10000
\widowpenalty = 10000

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%% Just for commenting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[usenames]{color}
\newcommand{\new}{\textcolor{red}}
\newcommand{\spe}{\textcolor{blue}}
\newcommand{\comment}{\textcolor{black}}

\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\ba}{\begin{equation} \begin{aligned}}
\newcommand{\ea}{\end{aligned} \end{equation}}

\def\X{\mathbf{X}}

\floatstyle{boxed}
\newfloat{Box}{tbph}{box}

\title{\textbf{ Matching forecast time-scale with ecological process }}

\author[1]{Peter B. Adler}  %\thanks{Corresponding author. Department of Wildland Resources and the Ecology Center, Utah State University, Logan, Utah Email: peter.adler@usu.edu}}
\author[2]{Ethan White}
\author[1]{Michael Cortez?}
\author[3]{Heather Lynch?}
\affil[1]{Department of Wildland Resources and the Ecology Center, Utah State University, Logan, Utah}
\affil[2]{some shitty Florida joint}

\renewcommand\Authands{ and }

% \date{Last compile: \today} 

\sloppy

\renewcommand{\baselinestretch}{1.25}

\begin{document}

\maketitle

\linenumbers

\section*{Abstract}

stuff

\textbf{\large{Keywords:}} dispersal, ecological forecasting, eco-evolutionary dynamics, global change, selection

\section*{Introduction}

A recent flurry of synthesis papers in high impact journals attests to surging interest in ecological forecasting. Many of the papers 
argue that a commitment to ecological forecasting is necessary to guide the environmental policy and management
decisions that will become increasingly critical under global change \citep{clark_ecological_2001,mouquet_review:_2015,dietze_iterative_2018}.
A second argument is that rigorous testing of predictions will accelerate the process of basic research and discovery 
\citep{houlahan_priority_2017,dietze_prediction_2017,dietze_iterative_2018}.
Taken together, these papers, along with a new textbook \citep{dietze_ecological_2017} represent an emerging consensus that 
forecasting should be a priority for ecological research.

No such consensus is available for exactly how to tackle this challenge.
Ecologists rely on many different approaches and models for making predictions, and 
frequently argue about the virtues of process-based vs. phenomenological models (refs?).
We often justify investments in basic research by claiming that improved process-level understanding will improve predictions (e.g., Adler et al. 2012),
and it is easy to find examples of how extrapolation of linear relationships leads to poor predictions under novel conditions (refs?).
But in many cases simple phenomenological models make better predictions than complex process-based models with high parameter
uncertainty (refs? \cite{tredennick_we_2017}?).

The pragmatic solution to these debates is clear: we should forecast using the models that make the best predictions.
Identifying these models requires rigorously testing predictions against observations. However, many common ecological predictions,
such as a species' geographic range in the year 2100, are virtually impossible to test (but see paleo hindcasting refs,Williams refs? Blois?), 
leading \citep{dietze_iterative_2018} to call for greater emphasis on near-term forecasting. The assumption is that building 
our capacity to make short-term forecasts will ultimately improve our long-term forecasts.

Our goal is to consider a hypothesis that, in our view, has not been carefully considered by either the push for near-term forecasting or
ongoing debates about competing modeling approaches. We expect that short and long-term forecasts will require models
incorporating different kinds of processes and fit to different kinds of data sets. We demonstrate this idea using two simulation case studies, the first for an 
eco-evolutionary scenario, the second concerned with feedbacks between community composition and ecosystem functioning. Our analyses show that: 
\begin{enumerate}
	\item For short-term forecasts, phenomenological time-series approaches are hard to beat, whereas longer-term forecasts require understanding slow 
	processes such as evolutionary and ecological selection as well as dispersal.
	\item Different kinds of data reflect the operation of different processes: longitudinal data capture autocorrelation and responses of current assemblages, while 
	data spanning spatial gradients capture the long-term outcome of selection and dispersal.  Whether predictive models should be trained using longitudinal or
	spatial data sets, or both, depends on the time-scale of the desired forecast.
	\item A key challenge for future research is determining the rate at which slow processes first influence and ultimately dominate dynamics.
\end{enumerate}

\section*{Modeling approach}

In both of our case studies, we simulate the effects of a hypothetical temperature increase on a simple system with known dynamics.
The ``truth'' is represented by a model that is mechanistic for at least one important process, but we assume that recovering 
this true, process-based model would be impossible in practice (we return to this point in the Discussion). We begin each simulation
under stationary temperature, allowing the system to equilibrate; we call this the baseline phase. We then increase temperature progressively
over a period of time, followed by a second period of stationary, now elevated, temperature. The objective is to forecast the response of the 
system to temperature increase based on data gathered during the baseline period. 

We make two forecasts based on two different phenomenological models, each representing processes operating at different time scales. 
The first phenomenological model represents what we call a ``spatial approach.'' We correlate the mean environment with the mean of an ecological state or rate 
 across many sites. This is the approach commonly used to predict population distribution or abundance as a function of climate (SDM refs) or
 primary production as a function of mean precipitation (Lauenroth refs). The approach is attractive because it addresses broad spatial scales relevant to 
 management, and because the necessary data are widely available and statistical analyses are straightforward. The approach also has well-known weaknesses.
Criticism often focuses on the assumption that current spatial patterns are in equilibrium with climate (refs?). Another issue is that these models are not dynamic; 
they provide no information about how quickly the system will move from the current state to the predicted, future state. Because the patterns in the data have developed 
over long time spans, they are unlikely to provide much information about dynamic changes on the order of years to decades. Moreover, transient dynamics could 
prevent the system from ever reaching the predicted steady state (Urban ref?). 

The second model represents what we call a ``temporal approach.'' We correlate interannual variation in an ecological response with interannual variation in the environment, 
typically at just one site. This approach is often used to study population or vital rate fluctuations as a function of weather \citep{dalgleish_climate_2011}, 
or primary production as a function of precipitation \citep{lauenroth_long-term_1992}. The advantages of this approach include is focus on temporal dynamics, meaning it 
can predict rates of change, and validation of the resulting near-term predictions are straightforward. However, models built using this approach typically cover 
a limited spatial extent (but see \cite{kleinhesselink_response_2018}, others), and ignore slower processes, such as evolutionary adaptation or turnover in community composition, 
that could alter the underlying process at longer time scales.

We compare forecasts from both models to the true, simulated dynamics to show that responses to environmental change reflect both kinds of processes, but at different time scales. To quantify this pattern, we combine forecasts from the spatial and temporal approaches with a weighted average and then show how the optimal model weights change over time: we expect the temporal model to best predict short-term dynamics, and the spatial model to best predict long-term dynamics. How rapidly that transition occurs depends on the rate of  ``slow" processes such as evolution and species turnover. 

\section*{Eco-evolutionary example}

Evolutionary adaptation is a key uncertainty in predicting how environmental change will impact a focal population at a given location (refs). To explore how this process influences dynamics and forecasts at different time scales, we consider a hypothetical annual plant population in which fecundity is temperature dependent, and different genotypes have different temperature optima (Fig. \ref{fig:spatial_model}A; the full model description is provided in the Appendix, and all computer code is available on Github: \texttt{https://github.com/pbadler/space-time-forecast}). Genotype frequencies will shift across a gradient of mean annual temperature: cold sites will be dominated by the cold-adapted homozygous genotype, warm sites will be dominated by the heat-adapted homozygous genotype, and intermediate sites will be dominated by the heterozygous genotype (Fig. \ref{fig:spatial_model}B).

\begin{figure}[tbp]
\centering
\includegraphics[width=1 \textwidth]{spatial_model.png}
\caption{(A) Reaction norms of the three genotypes. (B) The spatial pattern of individual genotypes and total population abundances at sites arrayed across a gradient of mean annual temperature. The dashed line shows predictions from an empirical ``spatial model," a linear regression that describes mean population size as a function of mean temperature. }
\label{fig:spatial_model}
\end{figure}

The spatial pattern shown in Fig. \ref{fig:spatial_model} is the outcome of steady-state conditions. But at any one site, the population's short-term response to temperature will be determined by the dominant genotype's reaction norm. For example, at a cold site dominated by the cold-adapted homozygous genotype, a warmer than average year would cause a decrease in population size, even though the heat-adapted homozygote might perform optimally at that same temperature. However, if warmer than normal conditions persist for many years, then genotype frequencies should shift, and the heat-adapted homozygote will compensate for the decreases of the cold-adapted genotype. 

To demonstrate these dynamics, we simulated a diploid annual plant population at a colder than average site. During the baseline period, the population is dominated by the cold-adapted genotype. We use the simulated data from this baseline period to fit an empirical model that assumes no knowledge of the underlying eco-evolutionary process. This empirical ``temporal model" predicts population growth rate as a function of annual temperature and population size (Fig. \ref{fig:temporal_model}). We then imposed a period of warming, followed by a final period of higher, but stationary, temperature (Fig. \ref{fig:forecast} top). With the onset of warming, the population crashed as the cold-adapted genotype decreased in abundance. Eventually, frequencies of the heterozygous genotype and the warm-adapted homozygous genotype began to increase and the population recovered (Fig. \ref{fig:forecast} bottom). 

\begin{figure}[tbp]
\centering
\includegraphics[width=0.6 \textwidth] {temporal_model.png}
\caption{The relationship between annual temperature and per capita growth rate at a location with a mean temperature that favors the cold-adapted genotype. Colors show population size, which also influences the population growth rate through density dependence.  }
\label{fig:temporal_model}
\end{figure}

The implications for forecasting are clear: In the initial stages of the warming trend, the temporal model fit to the original, baseline conditions should make better the best predictions 
about resulting population trends, but in the longer term, as evolutionary change occurs, the spatial model ultimately makes better predictions. 
To combine the spatial and temporal model into a single forecast, we fit a weighting parameter, $\omega$, which varies over time and is bounded between 0 and 1. At any time point, $t$, the combined population forecast is $\omega * T(N_{t-1},K_t) + (1-\omega) * S(K_t) $ where $T$ is the temporal model, which depends on population size, $N$ and expected temperature, $K$, and $S$ is the spatial model, which depends only on $K$ (see Appendix for full description of the approach). The temporal model accurately predicted the impact of the initial warming trend, but eventually became far too pessimistic, while the spatial model did not handle the initial trend but accurately predicted the eventual, new steady state (Fig. \ref{fig:forecast} bottom). The combined model initially reflected the temporal model, but then rapidly transitioned to reflect the spatial model. The rapid transition in the weighting term, $\omega$, occured during the period of most rapid change in genotype frequencies (Fig. \ref{fig:forecast_supp}). 

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {forecast.png}
\caption{(Top) Simulated annual temperatures (grey) and expected temperature (black), which was used to make forecasts. (Bottom) Simulated population size and forecasts from the spatial, temporal and combined models.  }
\label{fig:forecast}
\end{figure}

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {forecast_supplement.png}
\caption{Simulated shifts in genotype abundances, and the model weighting term, $\omega$, during the warming phase and the following stationary temperature phase.}
\label{fig:forecast_supp}
\end{figure}

The combined model's predictions look impressively accurate, but that is because we used the full, simulated time series to fit the weighting term. 
Unlike our spatial and temporal model forecasts, we did not generate out-of-sample predictions from the combined model; it merely provides 
a convenient way to quantify how rapidly dynamics shift from from being dominated by interannual 
variation to being dominated by steady-state equilibrium. To generate a true forecast from the combined model, we would need an independent 
method to predict how the model weights shift over time.

Next steps? Play with parameters to show what controls the rate of transition from temporal to spatial model?

\subsection*{Community turnover example}

In the previous example, evolutionary change was the slow process that determined how quickly the combined model shifted from a temporal to spatial forecast. 
The process of compositional turnover--change in the abundances and identities of species interacting at a site--can have a similar effect at the level of 
communities and even ecosystems. We demonstrate this using a metacommunity model developed by Alexander et al. (ref). The model describes Lotka-Volterra 
competitive interactions among plants within sites that are arrayed along an elevation and temperature gradient. Composition varies along the gradient because of a 
trade-off between growth rate and cold tolerance: cold sites are dominated by slow-growing species that can tolerate low temperatures, while warm sites are dominated by 
fast-growing species that are cold intolerant. Multiple species can coexist within sites because all species experience stronger competition from conspecifics than from heterospecifics. 
Sites are linked by dispersal: a specified fraction of each species' offspring leaves the site where they were produced and reaches all other sites with equal probability. 

As in our eco-evolutionary example, we simulated a baseline period with variable but stationary temperature, followed by a period of rapid temperature increase, and then a 
final period of stationary temperature. Interannual variation in temperature is the same at all sites, but mean temperature varies among sites. All sites experienced the 
same absolute increase in mean temperature. We focused on two response variables at one site in the middle of the gradient: 1) total community biomass and 
2) the biomass of one focal species that dominated the baseline period.

Dynamics during the baseline period revealed very strong spatial patterns across the mean temperature gradient. 
Individual species showed classic ``Whittaker" patterns of abundances across the gradient (Fig. \ref{fig:community-composition}), while time-averaged total community 
biomass increased strongly with temperature, because the fast-growing species at the warm sites produced more biomass. 
The average biomass of our focal species showed a unimodal pattern across the temperature gradient (Fig. \ref{fig:community-baseline}). 
These spatial patterns are the basis for our ``spatial models" of the temperature-biomass relationship. 

In contrast to the strong spatial patterns, population and community responses to interannual variation in temperature within sites were weak.
At our focal site in the center of the gradient, both total biomass and the biomass of the focal species were quite insensitive to interannnual variation in temperature (Fig. \ref{fig:community-baseline}). Our ``temporal models" estimate this weak temperature effect, along with strong lag effects of biomass in the previous year. 

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {mean_biomass_spp_by_site.png}
\caption{Mean biomass by species (colors) across the temperature gradient during the baseline period. The focal species, dominant at the site in the center of the gradient, is shown in dark blue.  }
\label{fig:community-composition}
\end{figure}

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {community_models.png}
\caption{Time-averaged spatial relationships between temperature and both total community biomass and the focal species' biomass are shown in blue, while interannual variations in total and focal species biomass at one site in the center of the gradient are shown in red. Symbols show simulated values, lines show predictions from statistical models fit to the simulated data.  }
\label{fig:community-baseline}
\end{figure}
 
We forecasted the effect of temperature increase on total biomass and the focal species' biomass using the spatial models and the temporal models. 
For total biomass, the spatial and temporal models both predicted immediate increases in biomass with warming, because all species respond positively to temperature increases. 
However, over time, as faster growing species increased in abundance at the focal site, biomass continued to increase, approaching the predictions of the spatial model 
(Fig. \ref{fig:community-forecasts} middle). The predictions of the spatial and temporal model for focal species biomass contrasted more dramatically, with the temporal 
model predicting a large increase in biomass and the spatial model predicting a decrease. Initially, the simulated abundances followed the increase predicted by the 
temporal model, but as faster-growing species increased in abundance, the biomass of the focal species then decreased, eventually falling below its baseline level 
(Fig. \ref{fig:community-forecasts} bottom). 

As in the eco-evolutionary example, we also fit a combined model as a weighted average of the spatial and temporal model, with the weights changing over time. 
For total biomass (the sum across all species), the weights for the combined model shifted rapidly to favor the spatial model, whereas for focal species biomass, 
the weights shifted more slowly towards the spatial model, as the biomass of the focal species decreased and its competitors' biomass increased (Fig. \ref{fig:community-weights}). 
Again, the combined model matches the simulated data because the weights were determined by fitting directly to those data. A true, combined forecast would require
a method to determine the model weights \emph{a priori}.

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {community_forecast.png}
\caption{(Top) Simulated annual temperatures (grey) and expected temperature (black), which was used to make forecasts, at the focal site. (Middle) Simulated total biomass and forecasts from the spatial, temporal and combined models. (Bottom) Simulated focal species' biomass and forecasts from the spatial, temporal and combined models. }
\label{fig:community-forecasts}
\end{figure}

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {community_change_plus_weights.png}
\caption{Simulated changes in biomass of the focal species (black) and all other species (grey) at the focal site in the metacommunity model, and the weight given to the temporal model for total biomass (blue) and focal species biomass (red).  }
\label{fig:community-weights}
\end{figure}


\subsection*{Discussion}

Our simulations demonstrate three lessons:

\emph{Lesson 1: For short-term forecasts, phenomenological time-series approaches are hard to beat, whereas longer-term forecasts require understanding slow 
processes such as evolutionary and ecological selection as well as dispersal.} [Ethan, I am hoping you can fix and add to this paragraph, perhaps
drawing from examples in other fields?] In the short-term, time-series approaches work well because lag effects are strong: the state of the system in the next 
time step depends heavily on the current state. Furthermore, in the short-term we usually are not extrapolating far into novel conditions; the historical range of variation 
may be a good guide when there has been little time for genotype frequencies or species composition to change. In contrast, farther we forecast into the future, 
the weaker the influence of the current state, and the more likely that slow processes like selection and dispersal will alter genotype frequencies and
species composition.
		
This lesson has implications for the emerging field of ecological forecasting. If we only focus on iterative, near-term forecasting, we are likely to find 
that time-series approaches work well, and that consideration of slow processes like evolution, dispersal, and compositional turnover rarely improves
forecast skill. Assuming that the same models will make good longer-term forecasts would be a mistake.

We do not mean to undermine the call for an emphasis on near-term forecasting. Building capacity to make near-term forecasts is extremely important, not
only because of the many critical applications (examples?) but because it is a necessary step to building a disciplinary culture and practice of ecological 
forecasting (cite Dietze?). It is also feasible, because we have the data to validate forecasts at short time-scales. Rather, the point is that near-term forecasting
alone is not enough. We also need to build capacity to make forecasts at time-scales where slow ecological processes cannot be ignored. The challenge 
will be finding ways to validate long-term predictions. Possibilities include hindcasting with paleoecological and long-term historical data sets, use of model
systems with short-generation times, and....simulations...? (or move this last bit to Lesson 3?).

\emph{Lesson 2. Different kinds of data reflect the operation of different processes; the choice of data for model training should depend on the time-scale of the desired forecast}.
Longitudinal data capture autocorrelation and responses of current assemblages, while data spanning spatial gradients capture the long-term outcome of 
selection and dispersal. For short-term forecasts, building models using longitudinal data is clearly the best choice. As our simulations show, models fit to 
steady-state, spatial patterns make terrible predictions in the short term. Conversely, models based on longitudinal data make poor predictions in the long-term,
while the models fit to spatial patterns can perform well. Although the temporal and spatial models we fit are phenomenological, they capture different kinds
 of underlying processes. The traditional debate about phenomenological vs. process-based models obscures the fact that, depending on the choice of the
 training data, phenomenological models can represent different kinds of processes.
 
 Why not simply build a process-based model? Perhaps something like the process-based models we used to generate the simulated time series in the first place? 
 That kind of model could make good predictions at both short and long time-scales. Unfortunately, this approach is just not feasible in most cases.
 The first challenge is simply determining the critical process. Take our eco-evolutionary example: should we simply assume that every annual plant species
 has warm and cold-adapted genotypes? And that temperature adaptation will be the key trait driving the response to warming, as opposed to the effects of 
 compositional turnover highlighted in our second example? Second, even if the key process is known in advance, fitting a mechanistic model presents its
 own set of challenges. The model for our eco-evolutionary example requires, in order of increasing empirical difficulty, demographic rates for the full life
 cycle, including density dependence, a quantitative mapping of genotype-by-environment interactions onto fitness, and dispersal kernels. The model for 
 our community and ecosystem example requires demography, environment-dependent intra- and interspecific competition coefficients, and dispersal kernels.
 We can think of empirical models that capture some of these features, but not all of them. Finally, even were it possible to fit such a model, the high number of 
 parameters and associated parameter error might lead to poor predictive skill (refs?).
 
Inevitably, models used for ecological forecasting will be partially if not entirely phenomenological. But that does not mean that they will not rely on process-based
understanding in some way. The point of our simulations is that different processes should be considered for different forecast time-scales, and this can be done 
by fitting phenomenological models to different kinds of data sets. Even when process-level understanding does not enable a fully mechanistic model, it can
improve the specification of phenomenological models.
 
\emph{Lesson 3. A key challenge for future research is determining the rate at which slow processes first influence and ultimately dominate dynamics.}
Our simulated examples suggest the potential for a combined forecast, which weights predictions from spatial and temporal models, to 
accurately forecast both short and long-term dynamics. But we cheated: our combined ``forecasts'' were fit to data, not generated prospectively
using \emph{a priori} model weights. Finding a general solution for determining those weights poses a fascinating research problem whose 
solution would lead to important applications in ecological forecasting. 

We see a role for new theory and new empirical tests. On the theoretical side, what are the parameters that determine how quickly slow processes
influence dynamics? We can play with our simulation models to provide some qualitative answers: the stronger the selection (at the level of genotype 
or species), the shorter the lifespan of the focal organisms, and the greater the dispersal, the more rapid the shift from the temporal to the spatial model
(should we actually DO these runs?). But providing general, analytical solutions would be difficult, even for our relatively simple models. 

On the empirical side, the key problem is finding or creating data sets to estimate the weighting function. As described under Lesson 1,
this requires data sets appropriate for validating long-term forecasts.
(Move material from end of  Lesson 1 down here?). With enough case studies, we might be able to infer patterns
that could guide applications in new systems.

Anything else to add?

\newpage
\renewcommand{\refname}{Literature cited}
\bibliographystyle{Ecology}
\bibliography{references}


%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
% APPENDICES !
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\clearpage 
\newpage 

\setcounter{page}{1}
\setcounter{equation}{0}
\setcounter{figure}{0}
\setcounter{section}{0}
\setcounter{table}{0}

\centerline{\Large \textbf{Appendices}}

\vspace{0.4in} 

\renewcommand{\theequation}{A-\arabic{equation}}
\renewcommand{\thetable}{A-\arabic{table}}
\renewcommand{\thefigure}{A-\arabic{figure}}
\renewcommand{\thesection}{\Alph{section}}

\section{Description of the eco-evolutionary annual plant model}

(from Michael Cortez)

\noindent \textbf{Haploid Model:} Begin with a haploid model that describes the number of seeds present in a seed bank.  $N_{i,t}$ is the number of seeds of species $i$ at time $t$.  The model is
\begin{align}\begin{split}
N_{1,t+1} &= s_1 [1-g_1(E_t)]N_{1,t}+\frac{\lambda_1g_1(E_t)N_{1,t}}{1+ \alpha_{11}g_1(E_t)N_{1,t} + \alpha_{12}g_2(E_t)N_{2,t}}\\
N_{2,t+1} &= s_2 [1-g_2(E_t)]N_{2,t}+\frac{\lambda_2g_2(E_t)N_{2,t}}{1+ \alpha_{21}g_1(E_t)N_{1,t} + \alpha_{22}g_2(E_t)N_{2,t}}
\end{split}\end{align}
where $g_{i}(E_t)$ is the probability of germination, $E_t$ is the environmental quality at time $t$, $s_i$ is the seed survival probability for species $i$, and $\lambda_i$ is the seed production rate per plant.  Below I refer to the $\alpha_{ij}$ as intra- and inter-specific competition coefficients.  \\

\noindent \textbf{Diploid Model:} Consider a one-species diploid model.  The genotypes are denoted by $AA$, $Aa$, and $aa$.   The number of each genotypes at time $t$ is $N_{AA,t}$, $N_{Aa,t}$, and $N_{aa,t}$.  The germination rates for each genotype are $g_{AA}(E_t)$, $g_{Aa}(E_t)$, and $g_{aa}(E_t)$.  The seed survival probability and seed production rate for genotype $AA$ are $s_{AA}$ and $\lambda_{AA}$, respectively.  The analogous parameters for the other genotypes are similarly denoted.  The competition coefficients are denoted by $\alpha_{i,j}$, e.g., $\alpha_{AA,AA}$ or $\alpha_{AA,Aa}$.  Throughout we assume that gametes mix randomly in the population.  

First consider the case where the competition coefficients are zero ($\alpha_{i,j}=0$).  Let $T$ denote the total number of gamete-pairs produced in a given year,
\begin{equation}
T = \lambda_{AA}N_{AA,t}g_{AA}(E_t)+ \lambda_{Aa}N_{Aa,t}g_{Aa}(E_t)+\lambda_{aa}N_{aa,t}g_{aa}(E_t).
\end{equation}
The first term is the number of gamete-pairs produced by $AA$ individuals.  The second and third terms are the numbers of gamete-pairs produced by $Aa$ and $aa$ individuals, respectively. The proportion of $A$ gametes ($\phi_A$) and the proportion of $a$ gametes ($\phi_a$) are given by
\begin{align}\begin{split}
\phi_{A} &= \frac{\lambda_{AA}N_{AA,t}g_{AA}(E_t)+ \frac{1}{2}\lambda_{Aa}N_{Aa,t}g_{Aa}(E_t)}{T} \hspace{10pt} \text{and} \hspace{10pt} \phi_a = 1-\phi_{A}.
\end{split}\end{align}
Note that the $T$ in the denominator of $\phi_A$ shows up because we are computing proportions.  Combining all of these we get the dynamics for each genotype,
\begin{align}\begin{split}
N_{AA,t+1} &= s_{AA}[1-g_{AA}(E_t)]N_{AA,t} + \phi_A^2T\\
N_{Aa,t+1} &= s_{Aa}[1-g_{Aa}(E_t)]N_{Aa,t} + \phi_A\phi_aT\\
N_{aa,t+1} &= s_{aa}[1-g_{aa}(E_t)]N_{aa,t} + \phi_a^2T
\end{split}\end{align}

Now consider the case where the competition coefficients are non-zero ($\alpha_{i,j}\neq0$).  Including competition changes the way in which we compute $T$, $\phi_A$, and $\phi_a$.  Specifically, because the total number of seeds produced per year by each genotypes is reduced based on intra- and inter-specific competition, the total number of gamete-pairs becomes
\begin{align}\begin{split}
T &=  \frac{\lambda_{AA}N_{AA,t}g_{AA}(E_t)}{1+ \alpha_{AA,AA}g_{AA}(E_t)N_{AA,t} + \alpha_{AA,Aa}g_{Aa}(E_t)N_{Aa,t}+ \alpha_{AA,aa}g_{aa}(E_t)N_{aa,t}} \\ 
&+ \frac{\lambda_{Aa}N_{Aa,t}g_{Aa}(E_t)}{1+ \alpha_{Aa,AA}g_{AA}(E_t)N_{AA,t} + \alpha_{Aa,Aa}g_{Aa}(E_t)N_{Aa,t}+ \alpha_{Aa,aa}g_{aa}(E_t)N_{aa,t}}\\
&+\frac{\lambda_{aa}N_{aa,t}g_{aa}(E_t)}{1+ \alpha_{aa,AA}g_{AA}(E_t)N_{AA,t} + \alpha_{aa,Aa}g_{Aa}(E_t)N_{Aa,t}+ \alpha_{aa,aa}g_{aa}(E_t)N_{aa,t}}.
\label{eqn:defineT}
\end{split}\end{align}
The first line is the number of gamete-pairs produced by $AA$ individuals after accounting for the effects of competition.  The second and third lines are the numbers of gamete-pairs produced by $Aa$ and $aa$ individuals, respectively. The proportions of $A$ gametes and $a$ gametes are 
\begin{align}\begin{split}
\phi_A &= \frac{1}{T}\frac{\lambda_{AA}N_{AA,t}g_{AA}(E_t)}{1+ \alpha_{AA,AA}g_{AA}(E_t)N_{AA,t} + \alpha_{AA,Aa}g_{Aa}(E_t)N_{Aa,t}+ \alpha_{AA,aa}g_{aa}(E_t)N_{aa,t}} \\
&+ \frac{1}{2T}\frac{\lambda_{Aa}N_{Aa,t}g_{Aa}(E_t)}{1+ \alpha_{Aa,AA}g_{AA}(E_t)N_{AA,t} + \alpha_{Aa,Aa}g_{Aa}(E_t)N_{Aa,t}+ \alpha_{Aa,aa}g_{aa}(E_t)N_{aa,t}}\\
\phi_a &= 1- \phi_A
\label{eqn:definePhi}
\end{split}\end{align}
Combining all of this results in the same model as above,
\begin{align}\begin{split}
N_{AA,t+1} &= s_{AA}[1-g_{AA}(E_t)]N_{AA,t} + \phi_A^2T\\
N_{Aa,t+1} &= s_{Aa}[1-g_{Aa}(E_t)]N_{Aa,t} + 2 \phi_A\phi_aT\\
N_{aa,t+1} &= s_{aa}[1-g_{aa}(E_t)]N_{aa,t} + \phi_a^2T,
\end{split}\end{align}
but the definitions of $T$, $\phi_A$, and $\phi_a$ are given by equations (\ref{eqn:defineT}) and (\ref{eqn:definePhi}) . 

\subsection{Estimating model weights}

Here is my home brew approach, presented in my typically terrible notation. There must be a better, more formal approach...Help?

The spatial model, which we refer to as $S$, is a linear regression fit to ``observed" data on mean population size, $\bar{N}$ at a series of locations, $x$, which vary in mean temperature, $K$. In our case, the observed data are simulated by the model described in the previous section. We include a quadratic term to capture the unimodal relationship between  $\bar{N}$ and $K$:
 \begin{equation}
 \bar{N}_x = S(K_x) = \beta^S_0 +  \beta^S_1 K_x +\beta^S_2 {K_x}^2 + \varepsilon
 \label{eqn:spatial_regression}
 \end{equation}

The temporal model, which we call $T$, starts with a time series of ``observed" population sizes, $\vec{N}$. Using data from a baseline period with a stationary distribution of annual temperature at one location, we fit the following regression, which predicts the (log) population growth rate as a function of population size and annual temperature at time $t$:
 \begin{equation}
 \ln(\frac{N_{t+1}}{N_t}) = T(N_t,K_t) = \beta^T_0 +  \beta^T_1 ln(N_t) +\beta^T_2 K_t + beta^T_3 {K_t}^2 +  \varepsilon
 \label{eqn:temporal_regression}
 \end{equation}
 
The temporal model returns a per capita growth rate on the log scale. To predict population size at the next time step, we simply exponentiate the growth rate and multiply it by the current population size: $exp(T(N_t,K_t)) N_t$.

The combined model is a weighted average of predictions from the spatial and temporal models, with the weights changing as a function of time, here expressed as the forecast horizon. The weights change as a function of the square root of the forecast horizon, to allow rapid shifts in the model weights. 
\begin{equation}
logit(\omega_t)=\beta^C_0 + \beta^C_1 \sqrt{t}
\label{eqn:weights}
\end{equation}
\begin{equation}
\hat{N}_{t+1} = \omega * exp(T(N_{t},K_t)) N_t + (1-\omega) * S(K_t) 
\label{eqn:combined_model}
\end{equation}

I used the \texttt{optim} function to estimate the $\beta^C$'s that minimize the sum of squared errors, $(\hat{N}_{t+1} - N_{t+1})^2$

\section{Description of the metacommunity model}

[How much detail to include from Alexander et al?]

The spatial model for total community biomass is a simple linear regression. The spatial model for the biomass of the focal species is a multiple regression with a quadratic term, identical to Eqn. \ref{eqn:spatial_regression}. The temporal model for total biomass, $M$, is:
 \begin{equation}
 \ln(M_{t+1} = T(M_{t},K_t) = \beta^T_0 +  \beta^T_1 M_t +\beta^T_2 K_t  +  \varepsilon .
 \label{eqn:community_temporal_regression}
 \end{equation}
The temporal model for focal species biomass has the same functional form. The combined models are based on the same approach that we used in the eco-evolutionary example (eqn. \ref{eqn:combined_model}).


\end{document}

